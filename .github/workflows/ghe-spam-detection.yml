# GHE Automation: Event E - SPAM Detection
# SECURITY: Env vars only. Very conservative - false positives worse than missed spam.

name: "GHE: SPAM Detection"

on:
  issues:
    types: [opened]

concurrency:
  group: ghe-spam-${{ github.event.issue.number }}
  cancel-in-progress: false

jobs:
  check-spam:
    if: github.event.sender.type != 'Bot'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      id-token: write

    steps:
      - uses: actions/checkout@v4

      - name: Check for spam
        uses: anthropics/claude-code-action@v1
        env:
          ISSUE_NUM: ${{ github.event.issue.number }}
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            Check issue $ISSUE_NUM for SPAM. Need 3+ indicators to confirm.
            Indicators: new account, no activity, many links, crypto/gambling.
            NOT spam: docs links, project mentions, legitimate questions.
            HIGH confidence: close with spam label. UNCERTAIN: do nothing.
            False positives are worse than missed spam. Be very conservative.
