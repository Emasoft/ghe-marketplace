{
  "hooks": [
    {
      "event": "SessionStart",
      "type": "prompt",
      "prompt": "## GHE Context Loader (Athena)\n\n### Step 0: Check Plugin Settings\n\nFirst, check if GHE is configured for this project:\n\n1. **Look for settings file**: `.claude/ghe.local.md`\n2. **If not found**: Plugin is using defaults (enabled, standard enforcement)\n3. **If found**: Parse YAML frontmatter to get settings:\n   - `enabled`: If false, skip all GHE features\n   - `enforcement_level`: strict/standard/lenient\n   - `serena_sync`: Whether to sync with SERENA memory bank\n   - `notification_level`: verbose/normal/quiet\n   - `auto_worktree`: Whether to auto-create git worktrees\n   - `current_issue`: The currently active issue number (if any)\n\n**Quick exit if disabled**: If `enabled: false`, skip remaining steps.\n\n### Step 1: Check for Active Work (if enabled)\n\n1. **Check for in-progress issues assigned to @me**:\n   - Run: `gh issue list --assignee @me --label \"in-progress\" --json number,title,labels,updatedAt`\n   - If found, this is your active thread\n\n2. **If active thread found**:\n   - Identify thread type from labels (type:dev, type:test, type:review)\n   - Read the last checkpoint: `gh issue view $ISSUE --comments`\n   - Parse the last State Snapshot to understand current state\n   - **Store issue number in memory for automatic transcription**\n   - Report to user (verbosity based on notification_level setting)\n\n3. **If no active thread**:\n   - Check for ready threads: `gh issue list --label \"ready\" --no-assignee`\n   - Report available work to user\n\n### Step 2: SERENA Memory Bank (if serena_sync enabled)\n\n4. **Check SERENA memory bank** (only if `serena_sync: true`):\n   - Read `.serena/memories/activeContext.md` for context\n   - Verify consistency with GitHub state\n   - Report any discrepancies\n\n### Step 3: Report Context Summary\n\n5. **Report based on notification_level**:\n   - **verbose**: Full details of active thread, available work, all settings\n   - **normal**: Active thread summary, available count, warnings only\n   - **quiet**: Only errors and critical warnings\n\nThis ensures continuity across sessions while respecting user preferences."
    },
    {
      "event": "UserPromptSubmit",
      "type": "prompt",
      "prompt": "## GHE Issue Tracker (Mnemosyne)\n\n**TRIGGER DETECTION**: Check if the user's message contains any of these patterns:\n- \"lets work on this new issue\"\n- \"let's work on this new issue\"\n- \"lets work on issue\"\n- \"let's work on issue\"\n- \"lets resume working on issue\"\n- \"let's resume working on issue\"\n- \"work on issue #\"\n- \"switch to issue #\"\n\n### If trigger detected:\n\n1. **Extract issue number** (if present):\n   - Pattern: `issue #(\\d+)` or `issue (\\d+)` or `#(\\d+)`\n   - If no number, this is a NEW issue request\n\n2. **For NEW issue**:\n   - Ask user for issue title and description\n   - Create issue: `gh issue create --title \"TITLE\" --body \"BODY\" --label \"type:dev\"`\n   - Assign to self: `gh issue edit NUMBER --add-assignee @me --add-label \"in-progress\"`\n   - Store issue number as `current_issue` in `.claude/ghe.local.md`\n\n3. **For EXISTING issue**:\n   - Verify issue exists: `gh issue view NUMBER`\n   - Check current phase from labels (type:dev, type:test, type:review)\n   - Claim if not assigned: `gh issue edit NUMBER --add-assignee @me --add-label \"in-progress\"`\n   - Store issue number as `current_issue` in `.claude/ghe.local.md`\n\n4. **Start automatic transcription**:\n   - **CRITICAL**: From this point forward, ALL exchanges must be posted to Issue #NUMBER\n   - Use the comment format from `plugins/ghe/skills/github-elements-tracking/references/templates/issue-comment-format.md`\n   - Spawn **Hephaestus** (`ghe:dev-thread-manager`) to manage this thread\n\n5. **Spawn parallel agents for other issues**:\n   - Check for other in-progress DEV issues: `gh issue list --label \"type:dev\" --label \"in-progress\" --json number`\n   - For each other issue, spawn a **Hephaestus** instance to monitor and update\n   - These run in background while user and Claude discuss the current issue\n\n### If no trigger detected:\n\n- Check if there's an active `current_issue` in `.claude/ghe.local.md`\n- If yes, **automatically post this exchange to the issue thread**\n- Use **Hephaestus** to post both user message and Claude response\n- Continue with normal conversation\n\n### Comment Format:\n\n```markdown\n<img src=\"AVATAR_URL\" width=\"77\" align=\"left\"/>\n\n**NAME said:**\n<br><br>\n\nCONTENT_HERE\n```\n\n**Avatar URLs**:\n- Emasoft: `https://avatars.githubusercontent.com/u/713559?v=4&s=77`\n- Claude: `https://robohash.org/claude-code-orchestrator.png?size=77x77&set=set3`"
    },
    {
      "event": "Stop",
      "type": "prompt",
      "prompt": "## GHE Session End (Mnemosyne)\n\nBefore ending, if there's an active issue:\n\n1. **Post final checkpoint** to the issue thread with:\n   - Summary of what was accomplished\n   - Current state\n   - Next steps (if any)\n\n2. **Update labels** if phase changed:\n   - Remove old phase label\n   - Add new phase label\n\n3. **Update SERENA memory** (if enabled):\n   - Write session summary to `.serena/memories/activeContext.md`"
    }
  ]
}
